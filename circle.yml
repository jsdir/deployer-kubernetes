machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - docker version
    - docker info
    - mkdir -p ~/docker
    - if [[ ! -e ~/docker/dind-kubernetes.tar ]]; then \
        docker pull llamashoes/dind-kubernetes && \
        docker save llamashoes/dind-kubernetes > ~/docker/dind-kubernetes.tar; \
      else docker load -i ~/docker/dind-kubernetes.tar; fi
    - if [[ ! -e ~/docker/kubectl ]]; then \
        wget -P /tmp https://github.com/GoogleCloudPlatform/kubernetes/releases/download/v0.10.1/kubernetes.tar.gz \
        tar -zxvf /tmp/kubernetes.tar.gz \
        cp kubernetes/platforms/linux/amd64/kubectl ~/docker \
      fi

test:
  override:
    - ./scripts/start-cluster.sh
